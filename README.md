# ABCDQC Batch Server

## Introduction
This is one of the projects from the February 2019 NCBI collaborative biodata science hackathon [http://biohackathons.github.io]. Our group is working on a project to automatically QC the [ABCD study data](https://data-archive.nimh.nih.gov/abcd) and provide interactive visualizations of the data.

This project is composed of three github repos ([abcdqc_webserver](https://github.com/abcdqc/abcdqc_webserver), [abcdqc_batchserver](https://github.com/abcdqc/abcdqc_batchserver), [abcdqc_hcp_notebooks](https://github.com/abcdqc/abcdqc_hpc_notebooks)) that work on two AWS instances and utilize the NIH high performance computing cluster. 

This repo contains a collection of notebooks prototyping the functionality of the batch server for ABCDQC.

## Background
The Adolescent Brain Cognitive Development (ABCD) study will track approximately 10,000 nine- and ten-year-old children longitudinally throughout adolescence and early adulthood. Approximately half the enrolled participants were identified as likelier to engage in high risk behaviors and/or develop mental health problems during adolescence. It is the largest neuroimaging study of this type, and aims to track the arc of mental health development within a nationally-representative sample. Data are generated by 21 imaging centers throughout the United States, with imaging acquisitions and parameters optimized for better compatibility across 3T scanners. Imaging data include T1-, T2- and diffusion-weighted structural scans and functional MRI. Both resting state and task-based fMRI scans are collected (Casey et al., 2018).

In partnership with the NIMH Data Archive (NDA), the ABCD Study releases fast-track data every month since June 2017. The fast-track data contains unprocessed neuroimaging data and rudimentary demographics. Processed and anonymized data including all the assessment criteria are released to the research community annually.

## Project Description
This project uses both the ABCD fast-track data and the available ABCD annual releases (currently Release 1.1), creates a uniformly bid-formatted release of the data, and runs the data through the MRI Quality Control (MRIQC) tool using the NIH High Performance Compute (HPC) Cluster. MRIQC calculates a variety of image-quality metrics (IQMs) and generates a summary JSON file per subject. On the project's batch server, this data is put into a unified table and sorted by selected variables (including age, sex, drug abuse risk, manual QC score, task type and run number, manufacturer and model, and the IQMs). To preserve subject confidentiality, no identifying information is tranferred from the batch server to the webserver. Instead, Kernel Density Estimates (KDEs) for each combination of variables are calculated and converted into JSONs. On the webserver, these JSONs are converted to interactive violin plots. These interactive visualizations of the QC results are available at [http://abcdqc.org]. Data can be sorted and viewed at different levels to compare different IQMs. 

## Workflow
![ABCDQC Project Schematic](https://raw.githubusercontent.com/abcdqc/abcdqc_batchserver/bd637699f54891a2556c20f1a52cda67324811ad/ABCDQCflowchart.png "Project Schematic")

## Purpose
This project allows the user to 

Potential applications include making comparisons by scanner manufacturer or model, analyzing the impact of age, sex, and other variables on iamge quality, comparing the ABCD Studyâ€™s IQMs to the IQMs of other publically available datasets, and creating a predictive model for future datasets. 

## Installation 
Coming soon

## How to Use
This repo expects the raw data from fast track as a series of `.json` files in `/abcdqc_data/mriqc/`and the release data in `/abcdqc_data/releases/1.1/`.

1. df-from-raw
2. munge_release_data
3. kde-gen

This process creates a set of `.json` files in `/abcdqc_data/batchserver/output/` that contain KDEs and statistics for boxplots for all permutations of selectors to subset the data to be used by the webserver.

## Next Steps
 * Develop main application that invokes the modules serially.
 * Create a pip/python package
 
## Relevant Resources 
 * [Initial Project Presentation (February 22, 2019)](https://docs.google.com/presentation/d/1SSinOI-IDNTdZreTARghN799z-Oi2Bn-H6-xFGCnIVc/edit?usp=sharing)
 * 
 *
 *

## Team Members
 * Dylan Nielson
 * Adam Thomas
 * Thomas Frohwein
 * Georgi Ivanov
 * Tom Panning
 * Rebecca Waugh
 * Kat Small
 * Anna Kondylis
